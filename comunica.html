<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Gráfico com Chart.js e MySQL</title>
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ABeeZee&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600&amp;display=swap">
    <link rel="stylesheet" href="../assets/css/bs-theme-overrides.css">
    <link rel="stylesheet" href="../assets/css/footer/Footer-Dark-icons.css">
    <link rel="stylesheet" href="../assets/css/FPE-Gentella-form-elements-custom.css">
    <link rel="stylesheet" href="../assets/css/FPE-Gentella-form-elements.css">
    <link rel="stylesheet" href="../assets/css/tela-login/Login-with-overlay-image.css">
    <style>
        /* Oculta o botão de voltar ao dashboard ao imprimir */
        @media print {
            .print-hide {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="container" style="margin-bottom:50px; margin-top: 20px">
            <img src="../assets/img/Logo_aguia-azul.png" alt="logo" style="width:300px; filter: invert(80%);">
            <h3 style="margin-top: 20px">Relatório de Ocorrências - Setor de Vídeo</h3>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-md-6" style="width: 580px;">
                <canvas id="myChart1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-6" style="width: 580px;">
                <canvas id="myChart2" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h2>Top 10 Motoristas com Mais Ocorrências</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Motorista</th>
                            <th>Ocorrências</th>
                        </tr>
                    </thead>
                    <tbody id="topMotoristas">
                        <!-- Os dados serão preenchidos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="container mt-4">
        <div style="display: flex;">
            <!-- Botão de volta para Painel -->
            <div style="margin-top: 20px;" class="print-hide">
                <a href="../painel.php" class="btn btn-primary">Voltar para Painel</a>
            </div>
            <!-- Botão de Gerar Impressão -->
            <div style="margin-top: 20px;" class="print-hide">
                <button onclick="imprimirPagina()" class="btn btn-secondary">Imprimir</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script>
        function imprimirPagina() {
            window.print();
        }

        // Função para carregar os 10 primeiros motoristas com mais ocorrências
        function carregarTopMotoristas() {
            var xmlhttp = new XMLHttpRequest();
            var url = "dados.php";

            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    var tableBody = document.getElementById("topMotoristas");

                    // Limpar o corpo da tabela
                    tableBody.innerHTML = "";

                    // Preencher a tabela com os dados dos motoristas
                    data.forEach(function (item, index) {
                        var row = "<tr>";
                        row += "<td>" + (index + 1) + "</td>";
                        row += "<td>" + item.motorista + "</td>";
                        row += "<td>" + item.total_ocorrencias + "</td>";
                        row += "</tr>";

                        tableBody.innerHTML += row;
                    });
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        // Chamar a função para carregar os motoristas quando a página carregar
        window.onload = function () {
            carregarTopMotoristas();
        };
    </script>
</body>

</html>
